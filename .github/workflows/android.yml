name: Android CI (Nuclear Clean Build)

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

permissions:
  contents: write
  pull-requests: write

jobs:
  build:
    name: Nuclear Clean Build
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 1
        clean: true  # ‚úÖ Force clean checkout
      
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # üî• NUCLEAR CACHE CLEANUP - STEP 1: Delete all cached data
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    - name: üî• Nuclear Cache Cleanup
      run: |
        echo "üî• NUCLEAR CLEANUP INITIATED"
        
        # Remove ALL Gradle caches
        rm -rf ~/.gradle/caches
        rm -rf ~/.gradle/wrapper
        rm -rf ~/.gradle/daemon
        rm -rf ~/.gradle/kotlin-dsl
        rm -rf ~/.gradle/build-scan-data
        rm -rf ~/.gradle/configuration-cache
        rm -rf ~/.gradle/notifications
        
        # Remove ALL Kotlin Native caches
        rm -rf ~/.konan
        
        # Remove ALL project build directories
        rm -rf .gradle
        rm -rf build
        rm -rf app/build
        rm -rf */build
        
        # Remove all intermediate files
        find . -type d -name "intermediates" -exec rm -rf {} + 2>/dev/null || true
        find . -type d -name "tmp" -exec rm -rf {} + 2>/dev/null || true
        find . -type d -name ".transforms" -exec rm -rf {} + 2>/dev/null || true
        
        # Remove all Kotlin compilation caches
        find . -type d -name "kotlin" -path "*/build/*" -exec rm -rf {} + 2>/dev/null || true
        
        echo "‚úÖ All caches destroyed"
        
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21'
        cache: 'gradle'  # This will create NEW clean cache
        
    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v4
      with:
        cache-read-only: false
        gradle-home-cache-cleanup: true
        cache-disabled: false  # Allow caching for NEXT build
        
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # üì¶ FRESH CACHE - Only after successful build
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    - name: Cache Gradle (Fresh)
      uses: actions/cache@v4
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
          ~/.gradle/daemon
          ~/.konan
        key: ${{ runner.os }}-gradle-nuclear-${{ github.run_number }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties', '**/libs.versions.toml') }}
        restore-keys: |
          ${{ runner.os }}-gradle-nuclear-${{ github.run_number }}-
    
    - name: Cache Build Outputs (Fresh)
      uses: actions/cache@v4
      with:
        path: |
          app/build/intermediates
          app/build/tmp
          build/kotlin
        key: ${{ runner.os }}-build-nuclear-${{ github.run_number }}-${{ github.sha }}
        restore-keys: |
          ${{ runner.os }}-build-nuclear-${{ github.run_number }}-
        
    - name: Grant execute permission
      run: chmod +x gradlew
      
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # üßπ PRE-BUILD CLEANUP
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    - name: üßπ Pre-build Gradle Clean
      run: |
        echo "üßπ Running Gradle clean..."
        ./gradlew clean --no-daemon --no-build-cache
        
        # Verify cleanup
        echo "üìä Checking cleanup status..."
        du -sh ~/.gradle/caches 2>/dev/null || echo "‚úÖ Gradle caches empty"
        du -sh app/build 2>/dev/null || echo "‚úÖ App build directory empty"
        
    - name: Create local.properties
      run: |
        cat > local.properties << EOF
        sdk.dir=$ANDROID_HOME
        ANTHROPIC_API_KEY=${{ secrets.ANTHROPIC_API_KEY }}
        GITHUB_TOKEN=${{ secrets.GH_TOKEN }}
        GITHUB_OWNER=test-owner
        GITHUB_REPO=test-repo
        EOF
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # üèóÔ∏è CLEAN BUILD FROM SCRATCH
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    - name: üèóÔ∏è Fresh Build Debug APK
      id: build
      run: |
        echo "üèóÔ∏è Starting CLEAN build..."
        
        # Capture FULL output including ALL errors
        ./gradlew assembleDebug \
          --no-build-cache \
          --no-configuration-cache \
          --rerun-tasks \
          --no-daemon \
          --stacktrace \
          --info \
          --parallel \
          --max-workers=4 \
          -Dorg.gradle.jvmargs="-Xmx5g -XX:+UseParallelGC -XX:MaxMetaspaceSize=1g" \
          -Dkotlin.incremental=false \
          -Dkotlin.compiler.execution.strategy=in-process \
          -Pkotlin.daemon.jvmargs="-Xmx2g" 2>&1 | tee full_build_log.txt
        
        # Save exit code
        echo "BUILD_EXIT_CODE=${PIPESTATUS[0]}" >> $GITHUB_ENV
      continue-on-error: true
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # üîç COMPREHENSIVE ERROR EXTRACTION
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    - name: üîç Extract ALL Compilation Errors
      if: always()
      run: |
        echo "# üî• COMPLETE BUILD ERROR REPORT" > COMPILATION_ERRORS.md
        echo "" >> COMPILATION_ERRORS.md
        echo "## üìä Build Information" >> COMPILATION_ERRORS.md
        echo "" >> COMPILATION_ERRORS.md
        echo "- **Build #:** ${{ github.run_number }}" >> COMPILATION_ERRORS.md
        echo "- **Commit:** \`${{ github.sha }}\`" >> COMPILATION_ERRORS.md
        echo "- **Branch:** \`${{ github.ref }}\`" >> COMPILATION_ERRORS.md
        echo "- **Exit Code:** \`${BUILD_EXIT_CODE:-unknown}\`" >> COMPILATION_ERRORS.md
        echo "- **Timestamp:** $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> COMPILATION_ERRORS.md
        echo "" >> COMPILATION_ERRORS.md
        
        if [ -f "full_build_log.txt" ]; then
          # Extract Kotlin compilation errors
          echo "## ‚ùå Kotlin Compilation Errors" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          echo '```kotlin' >> COMPILATION_ERRORS.md
          grep -E "^e: file://|^e: |error:" full_build_log.txt | head -200 >> COMPILATION_ERRORS.md || echo "No Kotlin errors found" >> COMPILATION_ERRORS.md
          echo '```' >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          
          # Extract BUILD FAILED section
          echo "## üö´ Build Failure Summary" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          echo '```' >> COMPILATION_ERRORS.md
          sed -n '/BUILD FAILED/,/BUILD FAILED/p' full_build_log.txt | head -50 >> COMPILATION_ERRORS.md || echo "No build failure section" >> COMPILATION_ERRORS.md
          echo '```' >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          
          # Extract task failures
          echo "## ‚ö†Ô∏è Failed Tasks" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          echo '```' >> COMPILATION_ERRORS.md
          grep "Task.*FAILED" full_build_log.txt >> COMPILATION_ERRORS.md || echo "No failed tasks logged" >> COMPILATION_ERRORS.md
          echo '```' >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          
          # Count errors
          ERROR_COUNT=$(grep -c "^e: " full_build_log.txt || echo "0")
          echo "## üìà Error Statistics" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          echo "- Total Kotlin errors: **${ERROR_COUNT}**" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
        else
          echo "‚ö†Ô∏è No build log found" >> COMPILATION_ERRORS.md
        fi
        
        # Check critical files
        echo "## üìÅ Source File Verification" >> COMPILATION_ERRORS.md
        echo "" >> COMPILATION_ERRORS.md
        
        if [ -f "app/src/main/java/com/docs/scanner/presentation/screens/editor/EditorViewModel.kt" ]; then
          echo "### ‚úÖ EditorViewModel.kt" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          echo '```kotlin' >> COMPILATION_ERRORS.md
          echo "// First 30 lines:" >> COMPILATION_ERRORS.md
          head -30 app/src/main/java/com/docs/scanner/presentation/screens/editor/EditorViewModel.kt >> COMPILATION_ERRORS.md
          echo '```' >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          
          echo "### üîç DomainResult Pattern Check" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          echo '```kotlin' >> COMPILATION_ERRORS.md
          grep -n "is DomainResult" app/src/main/java/com/docs/scanner/presentation/screens/editor/EditorViewModel.kt | head -30 >> COMPILATION_ERRORS.md || echo "No patterns found"
          echo '```' >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          
          # MD5 checksum
          MD5=$(md5sum app/src/main/java/com/docs/scanner/presentation/screens/editor/EditorViewModel.kt | cut -d' ' -f1)
          echo "**MD5:** \`${MD5}\`" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
        else
          echo "### ‚ùå EditorViewModel.kt NOT FOUND" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
        fi
        
        # Show full file for small error reports
        if [ "${ERROR_COUNT:-0}" -lt "20" ] && [ "${ERROR_COUNT:-0}" -gt "0" ]; then
          echo "## üìÑ Full Error Context" >> COMPILATION_ERRORS.md
          echo "" >> COMPILATION_ERRORS.md
          echo '```' >> COMPILATION_ERRORS.md
          grep -B5 -A5 "^e: " full_build_log.txt >> COMPILATION_ERRORS.md || true
          echo '```' >> COMPILATION_ERRORS.md
        fi
        
        echo "---" >> COMPILATION_ERRORS.md
        echo "" >> COMPILATION_ERRORS.md
        echo "üí° **Tip:** Check the [full build log artifact](#artifacts) for complete details." >> COMPILATION_ERRORS.md
        
        # Display to console
        cat COMPILATION_ERRORS.md
    
    - name: Unit Tests (Optional)
      if: success() && github.event_name == 'pull_request'
      run: ./gradlew testDebugUnitTest --no-daemon --stacktrace
      continue-on-error: true
    
    - name: Upload Full Build Log
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: build-logs-${{ github.run_number }}
        path: |
          full_build_log.txt
          COMPILATION_ERRORS.md
          app/build/reports/
          build/reports/
        retention-days: 7
        if-no-files-found: ignore
    
    - name: Upload APK
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: debug-apk-${{ github.run_number }}
        path: app/build/outputs/apk/debug/*.apk
        retention-days: 7
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # üéØ CREATE RELEASE WITH ERROR REPORT
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    - name: Create Release (Success or Failure)
      if: always() && github.event_name == 'push' && github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v2
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: ${{ env.BUILD_EXIT_CODE == '0' && '‚úÖ' || '‚ùå' }} Build v1.0.${{ github.run_number }}
        body: |
          ## üì± Nuclear Clean Build v1.0.${{ github.run_number }}
          
          **Status:** ${{ env.BUILD_EXIT_CODE == '0' && '‚úÖ SUCCESS' || '‚ùå FAILED' }}
          **üî• Built from scratch** - All caches purged
          
          **Commit:** `${{ github.sha }}`
          **Build #:** ${{ github.run_number }}
          **Strategy:** Nuclear clean (no cache reuse)
          **Exit Code:** `${{ env.BUILD_EXIT_CODE }}`
          
          ### üì¶ Downloads
          ${{ env.BUILD_EXIT_CODE == '0' && '- ‚úÖ **Debug APK** - See assets below' || '- ‚ùå **No APK** - Build failed' }}
          - üìÑ **[COMPILATION_ERRORS.md](COMPILATION_ERRORS.md)** - Complete error report
          - üìã **[Full Build Log](../../actions/runs/${{ github.run_id }})** - Detailed logs in artifacts
          
          ---
          
          ${{ env.BUILD_EXIT_CODE != '0' && '### ‚ö†Ô∏è Build Failed - See attached error report' || '### ‚ú® Build succeeded!' }}
          
        files: |
          app/build/outputs/apk/debug/*.apk
          COMPILATION_ERRORS.md
        fail_on_unmatched_files: false
        overwrite_files: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # üìä BUILD SUMMARY
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    - name: üìä Build Summary
      if: always()
      run: |
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "Build Status: ${{ job.status }}"
        echo "Exit Code: ${BUILD_EXIT_CODE:-unknown}"
        echo "Commit: ${{ github.sha }}"
        echo "Branch: ${{ github.ref }}"
        echo "Build #: ${{ github.run_number }}"
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        
        if [ "${BUILD_EXIT_CODE:-1}" == "0" ]; then
          echo "‚úÖ BUILD SUCCESSFUL"
          ls -lh app/build/outputs/apk/debug/ 2>/dev/null || echo "No APK found"
        else
          echo "‚ùå BUILD FAILED"
          echo ""
          echo "üìÑ Error report saved to: COMPILATION_ERRORS.md"
          echo "üìã Full log saved to: full_build_log.txt"
          echo ""
          echo "Quick error summary:"
          grep "^e: " full_build_log.txt | head -10 || echo "No errors captured"
        fi
        
        # Fail the job if build failed
        exit ${BUILD_EXIT_CODE:-1}