# ================================================================================
# DocumentScanner - gradle.properties
# Optimized for Gradle 9.x / Android AGP 8.9 / JDK 21+ / 2026 Standards
# Version: 6.0.0 - ULTRA OPTIMIZED
# ================================================================================

# ================================================================================
# JVM CONFIGURATION (JDK 21+ REQUIRED)
# ================================================================================
org.gradle.jvmargs=-Xmx8g \
    -Xms2g \
    -XX:+UseZGC \
    -XX:+ZGenerational \
    -XX:MaxMetaspaceSize=1g \
    -XX:+HeapDumpOnOutOfMemoryError \
    -XX:HeapDumpPath=./build/reports/heap-dump.hprof \
    -XX:+UseStringDeduplication \
    -XX:+OptimizeStringConcat \
    -Dfile.encoding=UTF-8 \
    -Dkotlin.daemon.jvm.options="-Xmx4g -XX:+UseZGC -XX:+ZGenerational"

# ✅ NEW: Gradle Daemon настройки
org.gradle.daemon=true
org.gradle.daemon.idletimeout=10800000
# ✅ NEW: Ограничиваем количество демонов (экономим ОЗУ)
org.gradle.jvmargs.daemon.count=2

# ================================================================================
# GRADLE PERFORMANCE
# ================================================================================
org.gradle.parallel=true
org.gradle.caching=true
org.gradle.configuration-cache=true
org.gradle.configuration-cache.problems=warn
org.gradle.vfs.watch=true
org.gradle.priority=normal
org.gradle.welcome=never

# ✅ NEW: Gradle 9.0+ flags
org.gradle.unsafe.isolated-projects=false  # Будет true в Gradle 10
org.gradle.configuration-cache.max-problems=500

# ✅ NEW: Kotlin compiler optimizations
kotlin.incremental.useClasspathSnapshot=true
kotlin.build.report.output=file

# ================================================================================
# KOTLIN CONFIGURATION
# ================================================================================
kotlin.code.style=official
kotlin.incremental=true
kotlin.incremental.usePreciseJavaTracking=true

# ✅ NEW: Kotlin 2.1+ compiler flags
kotlin.experimental.tryK2=false  # K2 stable in 2.1, но держим fallback
kotlin.compiler.execution.strategy=daemon
kotlin.daemon.jvmargs=-Xmx4g -XX:+UseZGC -XX:+ZGenerational

# ✅ NEW: Suppress warnings для production
kotlin.mpp.androidSourceSetLayoutVersion=2
kotlin.native.ignoreIncorrectDependencies=true

# ================================================================================
# ANDROID BUILD OPTIMIZATIONS
# ================================================================================
android.useAndroidX=true
android.enableJetifier=false
android.nonTransitiveRClass=true
android.nonFinalResIds=true

# ✅ NEW: R8 Full Mode (aggressive optimization)
android.enableR8.fullMode=true
android.enableR8.repositories=true

# ✅ NEW: D8 Desugaring optimizations
android.enableDexingArtifactTransform=true
android.enableDexingArtifactTransform.desugaring=true

# ✅ NEW: Baseline Profile support (Android 13+)
android.experimental.art-profile-r8-rewriting=true
android.experimental.r8.dex-startup-optimization=true

# ================================================================================
# BUILD FEATURES (Speed Optimization)
# ================================================================================
android.defaults.buildfeatures.buildconfig=true
android.defaults.buildfeatures.aidl=false
android.defaults.buildfeatures.renderscript=false
android.defaults.buildfeatures.resvalues=false
android.defaults.buildfeatures.shaders=false

# ✅ NEW: Disable unused features globally
android.defaults.buildfeatures.viewbinding=false
android.defaults.buildfeatures.databinding=false

# ================================================================================
# COMPOSE CONFIGURATION
# ================================================================================
composeCompilerReports=false

# ✅ NEW: Strong Skipping Mode (Compose 1.5+)
android.compose.experimental.kotlinCompilerExtensionVersion=1.5.15

# ================================================================================
# KSP CONFIGURATION
# ================================================================================
ksp.incremental=true
ksp.incremental.log=false
# ✅ NEW: KSP performance flags
ksp.useKSP2=false  # KSP2 experimental in Kotlin 2.1
ksp.allow.all.target.configuration=false

# ================================================================================
# PROJECT METADATA
# ================================================================================
APP_NAME=DocumentScanner
APP_VERSION_NAME=3.0.0
APP_VERSION_CODE=300
APPLICATION_ID=com.docs.scanner
MIN_SDK_VERSION=26
TARGET_SDK_VERSION=36
COMPILE_SDK_VERSION=36

# ================================================================================
# LOGGING & DEBUGGING
# ================================================================================
org.gradle.logging.level=lifecycle
org.gradle.console=auto
org.gradle.warning.mode=all

# ✅ NEW: Build performance logging
org.gradle.internal.launcher.welcomeMessageEnabled=false
org.gradle.internal.operations.trace=false  # Enable for debugging: true

# ================================================================================
# NETWORK CONFIGURATION
# ================================================================================
systemProp.http.connectionTimeout=60000
systemProp.http.socketTimeout=60000

# ✅ NEW: Maven repository timeout
systemProp.org.gradle.internal.http.connectionTimeout=60000
systemProp.org.gradle.internal.http.socketTimeout=60000

# ================================================================================
# DEPENDENCY RESOLUTION
# ================================================================================
# ✅ NEW: Fail fast on dependency conflicts
android.dependencyResolutionAtConfigurationTime.disallow=true
android.enableAdditionalTestOutput=false

# ================================================================================
# EXPERIMENTAL FLAGS (Cutting-Edge 2026)
# ================================================================================
# ✅ NEW: Test sharding for faster test execution
android.experimental.testOptions.emulatorSnapshots.maxSnapshotsForTestFailures=2

# ✅ NEW: Build Analyzer
android.experimental.enableBuildAnalyzer=true

# ✅ NEW: Selective compilation
android.experimental.enableSourceSetPathsMap=true

# ================================================================================
# SECURITY
# ================================================================================
# ✅ NEW: Enable dependency verification
systemProp.org.gradle.dependency.verification=strict

# ================================================================================
# INSTRUMENTATION TESTING
# ================================================================================
# ✅ NEW: Optimize instrumentation tests
android.testInstrumentationRunnerArguments.clearPackageData=true
android.testInstrumentationRunnerArguments.useTestStorageService=true
